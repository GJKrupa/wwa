<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:composition template="WEB-INF/templates/template-nav.xhtml">

        <ui:define name="head"><title><h:outputText value="#{messages.appName}"/></title></ui:define>

        <ui:define name="content">
            <div class="row">
                <div class="col-md-8">
                    <h2><h:outputText value="#{gamePlayController.game.name}"/></h2>

                    <p>
                        <h:form id="refreshForm">
                            <h:commandLink action="#{gamePlayController.clearRoundData}" styleClass="btn btn-info">
                                <i class="fa fa-refresh"></i> | <h:outputText value="#{messages.refresh}"/>
                            </h:commandLink>
                        </h:form>
                    </p>

                    <div class="card blackCard">
                        <div class="title">
                            <h:outputText value="#{gamePlayController.pendingText}"/>
                        </div>
                        <h:panelGroup styleClass="pick" rendered="#{gamePlayController.game.currentRound.blackCard.playCount gt 1}">
                            <div>
                                <h:outputText value="#{messages.play}"/> <span class="roundNumber"><h:outputText value="#{gamePlayController.game.currentRound.blackCard.playCount}"/></span>
                            </div>
                            <h:panelGroup rendered="#{gamePlayController.game.currentRound.blackCard.playCount gt 2}" layout="block">
                                <h:outputText value="#{messages.draw}"/> <span class="roundNumber">2</span>
                            </h:panelGroup>
                        </h:panelGroup>
                    </div>
                </div>

                <h:panelGroup rendered="#{gamePlayController.previousRoundAvailable}" layout="block" styleClass="col-md-4">
                    <h3><h:outputText value="#{messages.previousRound}"/></h3>
                    <div class="previous-round list-group">
                        <ui:repeat value="#{gamePlayController.players}" var="player">
                            <div class="list-group-item #{gamePlayController.playStyle}">
                                <h4 class="list-group-item-heading #{gamePlayController.playStyle}">
                                    <img src="#{player.user.imageUrl}" alt="avatar"/> <h:outputText value="#{player.user.fullName}: "/>
                                    (<h:outputText value="#{player.score}"/>)
                                </h4>
                                <p class="list-group-item-text">
                                    <h:outputText value="#{gamePlayController.previousRoundPlayText}" rendered="#{gamePlayController.previousRoundPlayText != null}" styleClass="#{gamePlayController.playStyle}" />

                                    <h:panelGroup rendered="#{gamePlayController.previousRoundPlayText == null}" styleClass="czar">
                                        <h:outputText value=" #{messages.czar} "/>
                                    </h:panelGroup>
                                </p>
                            </div>
                        </ui:repeat>
                    </div>
                </h:panelGroup>

            </div>

            <div class="row">

                <h:panelGroup rendered="#{!gamePlayController.playedMove and !gamePlayController.czar and (gamePlayController.canClear or !gamePlayController.canPlay)}" layout="block" styleClass="col-md-12">
                    <h:form id="commitForm">
                        <p>
                            <h:commandLink action="#{gamePlayController.commitPlay}" styleClass="btn btn-primary" rendered="#{!gamePlayController.canPlay}">
                                <i class="fa fa-upload"></i> | <h:outputText value="#{messages.playSelectedCards}"/>
                            </h:commandLink>
                            &nbsp;
                            <h:commandLink action="#{gamePlayController.clearPending}" styleClass="btn btn-warning" rendered="#{gamePlayController.canClear}">
                                <i class="fa fa-trash-o"></i> | <h:outputText value="#{messages.clear}"/>
                            </h:commandLink>
                        </p>
                    </h:form>
                </h:panelGroup>

                <h:panelGroup rendered="#{!gamePlayController.czar and !gamePlayController.playedMove}" styleClass="col-md-12">
                    <div class="col-md-12">
                        <h:form id="playCardForm">
                            <ui:repeat value="#{gamePlayController.myHand}" var="card">
                                <h:commandLink action="#{gamePlayController.playCard}" rendered="#{gamePlayController.canPlay and !gamePlayController.alreadyPlayed}">
                                    <div class="card whiteCard">
                                        <div class="title">
                                            <h:outputText value="#{card.text}"/>
                                        </div>
                                    </div>
                                </h:commandLink>
                            </ui:repeat>
                        </h:form>
                    </div>
                </h:panelGroup>

            </div>

            <div class="row">

                <h:panelGroup rendered="#{gamePlayController.czar}" styleClass="col-md-12">
                    <div class="col-md-12">
                        <h:form id="votingForm">
                            <ui:repeat value="#{gamePlayController.plays}" var="play">
                                <div class="card blackCard">
                                    <div class="title">
                                        <h:outputText value="#{gamePlayController.play}"/>
                                    </div>

                                    <h:panelGroup styleClass="pick" layout="block" rendered="#{gamePlayController.allPlayed}">
                                        <h:commandLink action="#{gamePlayController.selectWinner}" styleClass="btn btn-info">
                                            <i class="fa fa-thumbs-o-up"></i> | <h:outputText value="#{messages.winner}"/>
                                        </h:commandLink>
                                    </h:panelGroup>
                                </div>
                            </ui:repeat>
                        </h:form>
                    </div>
                </h:panelGroup>
            </div>
        </ui:define>

        <ui:define name="scripts">
            <script language="javascript" type="text/javascript">
                $(function() {
                    var socket = new SockJS("/game");
                    var stompClient = Stomp.over(socket);
                    stompClient.connect('fred', 'fred', function() {
                        stompClient.subscribe('/topic/game/#{gamePlayController.gameId}', function(message) {
                            if ($('#votingForm').size() != 0 &amp;&amp; message.body == '"PLAYED"') {
                                $('#refreshForm .btn').click();
                            } else if (message.body == '"JUDGED"') {
                                $('#refreshForm .btn').click();
                            }
                        })
                    });
                });
            </script>
        </ui:define>
    </ui:composition>

</html>