<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        >

    <ui:composition template="WEB-INF/templates/template-nav.xhtml">
        <ui:define name="head"><title><h:outputText value="#{messages.appName}"/></title></ui:define>

        <ui:define name="content">
            <div class="row">
                <div class="col-md-12">
                    <h2><h:outputText value="#{messages.createNewGame}"/></h2>
                    <h:form id="createGame">
                        <div class="form-group">
                            <label for="gameName"><h:outputText value="#{messages.name}"/></label>
                            <h:inputText id="gameName" styleClass="form-control" value="#{gameManagerController.name}"/>
                        </div>
                        <h:commandLink action="#{gameManagerController.createGame}" styleClass="btn btn-primary">
                            <i class="fa fa-plus"></i> | <h:outputText value="#{messages.createGame}"/>
                        </h:commandLink>
                    </h:form>
                </div>

                <div class="col-md-6">
                    <h2><h:outputText value="#{messages.myGames}"/></h2>
                    <h:form id="myGame">
                        <ul class="list-group">
                            <ui:repeat value="#{gameManagerController.myGames}" var="game">
                                <li class="list-group-item">
                                    <span class="badge"><h:outputText value="#{game.playerCount}"/></span>
                                    <h4 class="list-group-item-heading"><h:outputText value="#{game.name}"/></h4>
                                    <p class="list-group-item-text">
                                        <h:outputText value="#{messages.owner}"/>:
                                        <h:outputText value="#{game.owner.user.fullName}" rendered="#{!gameManagerController.myGame}"/>
                                        <h:outputText value="Me" rendered="#{gameManagerController.myGame}"/>
                                    </p>

                                    <p>
                                        <h:outputText value="#{messages.players}"/>:
                                    </p>
                                    <ul class="userList">
                                        <ui:repeat value="#{game.playerList}" var="player">
                                            <li>
                                                <img src="#{player.user.imageUrl}" alt="avatar"/> <h:outputText value="#{player.user.fullName}"/>:
                                                <h:outputText value="#{player.score}"/>
                                            </li>
                                        </ui:repeat>
                                    </ul>

                                    <p>
                                        <h:commandLink action="#{gameManagerController.openGame}" styleClass="btn btn-info">
                                            <i class="fa fa-folder-open"></i> | <h:outputText value="#{messages.open}"/>
                                        </h:commandLink>

                                        <h:commandLink action="#{gameManagerController.startGame}" styleClass="btn btn-success" rendered="#{gameManagerController.myGame and game.playerCount gt 2 and game.currentRound == null}">
                                            <i class="fa fa-check-circle"></i> | <h:outputText value="#{messages.start}"/>
                                        </h:commandLink>
                                    </p>
                                </li>
                            </ui:repeat>
                        </ul>
                    </h:form>
                </div>

                <div class="col-md-6">
                    <h2><h:outputText value="#{messages.availableGames}"/></h2>
                    <h:form id="openGame">
                    <ul class="list-group">
                        <ui:repeat value="#{gameManagerController.openGames}" var="game">
                            <li class="list-group-item">
                                <span class="badge"><h:outputText value="#{game.playerCount}"/></span>
                                <h4 class="list-group-item-heading"><h:outputText value="#{game.name}"/></h4>
                                <p>
                                    <h:outputText value="#{messages.owner}"/>: <h:outputText value="#{game.owner.user.fullName}"/>
                                </p>
                                <p>
                                    <h:commandLink action="#{gameManagerController.joinGame}" styleClass="btn btn-success">
                                        <i class="fa fa-users"></i> | <h:outputText value="#{messages.join}"/>
                                    </h:commandLink>
                                </p>
                            </li>
                        </ui:repeat>
                    </ul>
                    </h:form>
                </div>

            </div>

        </ui:define>

        <ui:define name="scripts">
            <script language="javascript" type="text/javascript">
                $(function() {
                    var socket = new SockJS("/wwa-1.0/game");
                    var stompClient = Stomp.over(socket);
                    stompClient.connect('fred', 'fred', function() {
                        stompClient.send('/app/demo', {}, '"BLAHBLAH"');
                    });
                });
            </script>
        </ui:define>
    </ui:composition>

</html>